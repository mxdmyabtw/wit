<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Win is Key - Shop</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/header-shared.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { overflow-x: hidden; max-width: 100vw; }
    body { font-family: 'Space Grotesk', sans-serif; background: #0d0f14; color: #f4f4f5; min-height: 100vh; }
    .font-heading { font-family: 'Orbitron', sans-serif; }
    .app { display: flex; min-height: 100vh; }
    .sidebar {
      position: fixed; left: 0; top: 0; bottom: 0; width: 64px;
      background: rgba(24, 24, 27, 0.98); border-right: 1px solid #27272a;
      display: flex; flex-direction: column; align-items: center; padding-top: 1rem; gap: 0.5rem; z-index: 100;
    }
    .sidebar .logo-mini { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; text-decoration: none; margin-bottom: 1rem; overflow: hidden; }
    .sidebar .logo-mini img { width: 100%; height: 100%; object-fit: contain; }
    .sidebar a { width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; border-radius: 8px; color: #71717a; text-decoration: none; font-size: 1.25rem; transition: all 0.2s; }
    .sidebar .nav-icon { font-size: 1.35rem; width: 21px; height: 21px; object-fit: contain; }
    .sidebar a:hover { color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
    .sidebar a.active { color: #2563eb; background: rgba(37, 99, 235, 0.2); }
    .main-wrap { flex: 1; margin-left: 64px; min-width: 0; display: flex; flex-direction: column; min-height: 100vh; max-width: calc(100vw - 64px); }
    main { flex: 1; padding-top: 72px; display: flex; min-height: 100vh; min-width: 0; overflow: hidden; }

    .shop-cats {
      width: 180px; padding: 1rem; border-right: 1px solid #27272a;
      display: flex; flex-direction: column; gap: 0.5rem;
    }
    .shop-cats button {
      display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem;
      background: transparent; border: 1px solid transparent; border-radius: 8px;
      color: #a1a1aa; cursor: pointer; font-size: 0.9rem; text-align: left;
    }
    .shop-cats button:hover { background: rgba(39, 39, 42, 0.8); color: #f4f4f5; }
    .shop-cats button.active { background: rgba(37, 99, 235, 0.2); border-color: #2563eb; color: #60a5fa; }
    .shop-cats button .ico { font-size: 1.25rem; filter: grayscale(100%); opacity: 0.9; }
    .shop-cats button.active .ico { filter: grayscale(0); opacity: 1; }

    .shop-body { flex: 1; padding: 1.5rem 2rem; min-width: 0; overflow-x: hidden; }
    .shop-body h1 { font-size: 1.5rem; margin-bottom: 1.5rem; }
    .shop-content { display: none; }
    .shop-content.active { display: block; }
    .shop-content.placehold { color: #71717a; padding: 2rem; }

    .bundle-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 1.5rem; }
    .bundle-card {
      position: relative;
      background: linear-gradient(145deg, rgba(39, 39, 42, 0.9), rgba(24, 24, 27, 0.9));
      border: 2px solid #3f3f46; border-radius: 14px;
      padding: 1.25rem; display: flex; flex-direction: column; align-items: center;
      transition: border-color 0.2s, transform 0.2s, box-shadow 0.2s;
      overflow: hidden;
    }
    .bundle-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; }
    .bundle-card.blue { border-color: #3b82f6; }
    .bundle-card.blue::before { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
    .bundle-card.red { border-color: #ef4444; }
    .bundle-card.red::before { background: linear-gradient(90deg, #ef4444, #f87171); }
    .bundle-card.green { border-color: #22c55e; }
    .bundle-card.green::before { background: linear-gradient(90deg, #22c55e, #4ade80); }
    .bundle-card.gold { border-color: #eab308; }
    .bundle-card.gold::before { background: linear-gradient(90deg, #eab308, #fde047); }
    .bundle-card:hover { transform: translateY(-6px); box-shadow: 0 16px 32px rgba(0,0,0,0.5); }
    .bundle-card.blue:hover { border-color: #60a5fa; box-shadow: 0 16px 32px rgba(59,130,246,0.3); }
    .bundle-card.red:hover { border-color: #f87171; box-shadow: 0 16px 32px rgba(239,68,68,0.3); }
    .bundle-card.green:hover { border-color: #4ade80; box-shadow: 0 16px 32px rgba(34,197,94,0.3); }
    .bundle-card.gold:hover { border-color: #fde047; box-shadow: 0 16px 32px rgba(234,179,8,0.3); }

    .bundle-label {
      display: flex; align-items: center; justify-content: center; gap: 0.4rem;
      margin-bottom: 0.75rem; padding: 0.35rem 0.75rem; border-radius: 8px;
    }
    .bundle-card.blue .bundle-label { background: rgba(59,130,246,0.15); }
    .bundle-card.red .bundle-label { background: rgba(239,68,68,0.15); }
    .bundle-card.green .bundle-label { background: rgba(34,197,94,0.15); }
    .bundle-card.gold .bundle-label { background: rgba(234,179,8,0.15); }
    .bundle-label .coin-mini { width: 24px; height: 24px; object-fit: contain; }
    .bundle-label span { font-size: 1rem; font-weight: 700; color: #f59e0b; }
    .chest-img-wrap {
      width: 100%; height: 120px; margin-bottom: 1rem;
      display: flex; align-items: center; justify-content: center;
      background: radial-gradient(ellipse at center, rgba(0,0,0,0.3) 0%, transparent 70%);
      border-radius: 10px;
    }
    .chest-img { max-width: 95px; max-height: 95px; object-fit: contain; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.4)); }
    .bundle-card.blue .chest-img { filter: hue-rotate(165deg) saturate(1.25) drop-shadow(0 4px 12px rgba(59,130,246,0.2)); }
    .bundle-card.red .chest-img { filter: hue-rotate(-35deg) saturate(1.2) drop-shadow(0 4px 12px rgba(239,68,68,0.2)); }
    .bundle-card.green .chest-img { filter: hue-rotate(85deg) saturate(1.25) drop-shadow(0 4px 12px rgba(34,197,94,0.2)); }
    .bundle-card.gold .chest-img { filter: hue-rotate(20deg) saturate(1.4) brightness(1.08) drop-shadow(0 4px 12px rgba(234,179,8,0.25)); }
    .bundle-price { font-size: 1rem; font-weight: 700; color: #a1a1aa; margin-bottom: 0.5rem; }
.bundle-card .btn-buy { width: 100%; padding: 0.6rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 0.8rem; }
    .bundle-card.blue .btn-buy { background: #3b82f6; color: #fff; }
    .bundle-card.red .btn-buy { background: #ef4444; color: #fff; }
    .bundle-card.green .btn-buy { background: #22c55e; color: #fff; }
    .bundle-card.gold .btn-buy { background: #eab308; color: #0d0f14; }
    .bundle-card .btn-buy:hover { opacity: 0.9; }

    .gift-section { margin-top: 2.5rem; padding-top: 1.5rem; border-top: 1px solid #3f3f46; max-width: 400px; }
    .gift-section h3 { font-size: 1rem; margin-bottom: 1rem; color: #a1a1aa; display: flex; align-items: center; gap: 0.5rem; }
    .gift-section .gift-icon { font-size: 1.25rem; }
    .gift-code-row { display: flex; gap: 0.5rem; align-items: center; }
    .gift-code-row input {
      flex: 1; padding: 0.65rem 1rem; border-radius: 8px; border: 1px solid #3f3f46;
      background: rgba(39, 39, 42, 0.8); color: #f4f4f5; font-size: 0.95rem;
    }
    .gift-code-row input::placeholder { color: #71717a; }
    .gift-code-row input:focus { outline: none; border-color: #f59e0b; }
    .btn-gift {
      display: flex; align-items: center; gap: 0.5rem; padding: 0.65rem 1.25rem;
      background: linear-gradient(135deg, #f59e0b, #d97706); border: none; border-radius: 8px;
      color: #0d0f14; font-weight: 700; cursor: pointer; font-size: 0.9rem; transition: opacity 0.2s;
    }
    .btn-gift:hover { opacity: 0.9; }
    .btn-gift .gift-icon { font-size: 1.1rem; }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <a href="/" class="logo-mini"><img src="/images/logo-noir.png" alt="WIT"></a>
      <a href="/" title="Home"><img src="/images/home.svg" alt="Home" class="nav-icon"></a>
      <a href="/matches" title="Matches"><img src="/images/matches.svg" alt="Matches" class="nav-icon"></a>
      <a href="/tournois" title="Tournaments"><img src="/images/tournament.svg" alt="Tournaments" class="nav-icon"></a>
      <a href="/boutique" class="active" title="Shop"><img src="/images/shop.svg" alt="Shop" class="nav-icon"></a>
    </aside>
    <div class="main-wrap">
      <div class="top-bar">
        <div class="top-bar-left">
          <div class="search-wrap">
            <span class="search-icon"><img src="/images/search.svg" alt="" aria-hidden="true"></span>
            <input type="text" id="search-input" placeholder="Search username...">
          </div>
        </div>
        <div class="top-bar-right">
          <a href="/boutique" class="coins-display">
            <img src="/images/coin.png" alt="" class="coin-icon">
            <span id="coins">0</span>
          </a>
          <span class="snipes-display" title="Snipes pour voir un adversaire avant le match">
            <svg class="snipe-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
            <span id="snipes">0</span>
          </span>
          <div id="auth-area"></div>
        </div>
      </div>
      <div id="modal-profile" class="modal-profile">
        <div class="modal-profile-inner">
          <button class="modal-close" type="button">&times;</button>
          <h2>Profile</h2>
          <div class="profile-header">
            <div class="profile-pdp-wrap" title="Click to change">
              <img class="profile-pdp" alt="avatar">
              <input type="file" accept="image/*" style="display:none">
            </div>
            <div class="profile-info">
              <div class="profile-pseudo">-</div>
              <div class="profile-pseudo-edit">
                <input type="text" id="profile-pseudo-input" placeholder="Changer pseudo" maxlength="20">
                <button type="button" id="profile-pseudo-btn">Valider</button>
              </div>
              <div class="profile-links">
                <button type="button" class="btn-link-epic"><span class="btn-icon btn-icon-epic" aria-hidden="true"></span>Epic Games</button>
                <button type="button" class="btn-link-discord"><span class="btn-icon btn-icon-discord" aria-hidden="true"></span>Discord</button>
                <button type="button" class="btn-logout">Logout</button>
              </div>
            </div>
          </div>
          <div class="profile-stats">
            <div class="profile-stat"><div class="label">Total coins earned</div><div class="value stat-total">0</div></div>
            <div class="profile-stat"><div class="label">Wins</div><div class="value stat-wins">0</div></div>
            <div class="profile-stat"><div class="label">Losses</div><div class="value stat-losses">0</div></div>
            <div class="profile-stat"><div class="label">Matches played</div><div class="value stat-matches">0</div></div>
          </div>
        </div>
      </div>
  <main class="shop">
    <nav class="shop-cats">
      <button class="shop-tab active" data-cat="piece"><span class="ico">&#128176;</span> Coins</button>
      <button class="shop-tab" data-cat="snipe"><span class="ico">&#127919;</span> Snipe</button>
      <button class="shop-tab" data-cat="tag"><span class="ico">&#127991;</span> Tag</button>
    </nav>
    <div class="shop-body">
      <h1 class="font-heading">Shop</h1>
      <div class="shop-content active" id="cat-piece">
        <div class="bundle-grid" id="piece-grid"></div>
        <div class="gift-section">
          <h3><span class="gift-icon">&#127873;</span> Gift code</h3>
          <div class="gift-code-row">
            <input type="text" id="gift-input" placeholder="Enter your gift code" maxlength="20" />
            <button type="button" class="btn-gift"><span class="gift-icon">&#127873;</span> Use</button>
          </div>
        </div>
      </div>
      <div class="shop-content" id="cat-snipe">
        <p class="shop-desc" style="margin-bottom:1rem;color:#a1a1aa;">Les snipes permettent de voir le profil de l'adversaire avant de rejoindre un match.</p>
        <div class="bundle-grid" id="snipe-grid"></div>
      </div>
      <div class="shop-content placehold" id="cat-tag">Tag - Coming soon</div>
    </div>
  </main>
  <footer class="footer-wrap">
    <a href="/" class="footer-logo font-heading"><span class="logo-title">Win is Key</span><span class="logo-wit">WIT</span></a>
    <div class="footer-social">
      <a href="https://discord.gg/nPvsqw7JSc" target="_blank" rel="noopener" title="Rejoindre notre Discord">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.37a19.8 19.8 0 0 0-4.885-1.5.07.07 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.3 18.3 0 0 0-5.487 0 12.6 12.6 0 0 0-.617-1.25.08.08 0 0 0-.079-.037A19.7 19.7 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.08.08 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.08.08 0 0 0 .084-.028 14.1 14.1 0 0 0 1.226-1.994.08.08 0 0 0-.041-.106 13.1 13.1 0 0 1-1.872-.892.08.08 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.07.07 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.07.07 0 0 1 .078.01c.12.098.246.198.373.292a.08.08 0 0 1-.006.127 12.3 12.3 0 0 1-1.873.892.08.08 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.08.08 0 0 0 .084.028 19.8 19.8 0 0 0 6.002-3.03.08.08 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.06.06 0 0 0-.031-.03z"/></svg>
      </a>
    </div>
    <nav class="footer-nav">
      <a href="/">Home</a>
      <a href="/matches">Matches</a>
      <a href="/tournois">Tournaments</a>
      <a href="/boutique">Shop</a>
    </nav>
    <p class="footer-copy">© 2025 Win is Key</p>
  </footer>
    </div>
  </div>
  <script src="/config-discord.js"></script>
  <script src="/config-firebase.js"></script>
  <script src="/auth.js"></script>
  <script src="/header-init.js"></script>
  <script src="/gift-codes.js"></script>
  <script src="/boutique-payment.js"></script>
  <script>
    const PRICES_EUR = { 5: '5', 10: '10', 15: '15', 20: '20', 25: '25', 50: '50', 100: '100' };
    const bundles = [
      { amount: 5, color: 'blue' },
      { amount: 10, color: 'red' },
      { amount: 15, color: 'red' },
      { amount: 20, color: 'green' },
      { amount: 25, color: 'green' },
      { amount: 50, color: 'blue' },
      { amount: 100, color: 'gold' }
    ];

    if (window.WitBoutiquePayment) {
      window.WitBoutiquePayment.handlePaymentSuccess();
      window.WitBoutiquePayment.initCoins();
      window.WitBoutiquePayment.initSnipes();
    } else {
      document.getElementById('coins').textContent = parseFloat(localStorage.getItem('wit-coins') || '1000').toLocaleString('en-US', {minimumFractionDigits:1});
    }

    const grid = document.getElementById('piece-grid');
    bundles.forEach(b => {
      const card = document.createElement('div');
      card.className = 'bundle-card ' + b.color;
      const price = PRICES_EUR[b.amount] || '—';
      card.innerHTML = `
        <div class="bundle-label">
          <img src="/images/coin.png" alt="" class="coin-mini">
          <span>${b.amount} coins</span>
        </div>
        <div class="chest-img-wrap">
          <img src="/images/chest.png" alt="" class="chest-img">
        </div>
        <button class="btn-buy" data-amount="${b.amount}">${price}$ PURCHASE</button>
      `;
      card.querySelector('.btn-buy').addEventListener('click', function(ev) {
        var amt = parseInt(this.getAttribute('data-amount'), 10);
        (window.WitAuth && window.WitAuth.login ? window.WitAuth.login() : Promise.resolve(null)).then(function() {
          if (window.WitBoutiquePayment && window.WitBoutiquePayment.payWithCard) {
            window.WitBoutiquePayment.payWithCard(amt, ev);
          }
        });
      });
      grid.appendChild(card);
    });

    const snipeBundles = [
      { amount: 5, cost: 5, color: 'blue' },
      { amount: 20, cost: 15, color: 'red' },
      { amount: 50, cost: 30, color: 'gold' }
    ];
    const snipeGrid = document.getElementById('snipe-grid');
    snipeBundles.forEach(b => {
      const card = document.createElement('div');
      card.className = 'bundle-card ' + b.color;
      card.innerHTML = `
        <div class="bundle-label snipe-label">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:24px;height:24px;color:#ef4444"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
          <span>${b.amount} snipes</span>
        </div>
        <div class="chest-img-wrap">
          <img src="/images/chest.png" alt="" class="chest-img">
        </div>
        <div class="bundle-price">
          <img src="/images/coin.png" alt="" style="width:18px;height:18px;vertical-align:middle"> ${b.cost} coins
        </div>
        <button class="btn-buy btn-buy-snipe" data-amount="${b.amount}" data-cost="${b.cost}">ACHETER</button>
      `;
      card.querySelector('.btn-buy-snipe').addEventListener('click', function() {
        (window.WitAuth && window.WitAuth.login ? window.WitAuth.login() : Promise.resolve()).then(function() {
          var amt = parseInt(this.getAttribute('data-amount'), 10);
          var cost = parseInt(this.getAttribute('data-cost'), 10);
          if (window.WitBoutiquePayment && window.WitBoutiquePayment.buySnipesWithCoins) {
            if (window.WitBoutiquePayment.buySnipesWithCoins(amt, cost)) {
              if (window.WitBoutiquePayment.refreshCoins) window.WitBoutiquePayment.refreshCoins();
              if (window.WitBoutiquePayment.refreshSnipes) window.WitBoutiquePayment.refreshSnipes();
            } else {
              alert('Pas assez de coins. Achetez des coins d\'abord.');
            }
          }
        }.bind(this));
      });
      snipeGrid.appendChild(card);
    });

    function switchToCat(cat) {
      var tab = document.querySelector('.shop-tab[data-cat="' + cat + '"]');
      if (tab) {
        document.querySelectorAll('.shop-tab').forEach(function(x) { x.classList.remove('active'); });
        document.querySelectorAll('.shop-content').forEach(function(x) { x.classList.remove('active'); });
        tab.classList.add('active');
        var catEl = document.getElementById('cat-' + cat);
        if (catEl) catEl.classList.add('active');
      }
    }
    if (window.location.hash === '#snipe') switchToCat('snipe');

    document.querySelectorAll('.shop-tab').forEach(t => t.addEventListener('click', () => {
      switchToCat(t.dataset.cat);
    }));

    (function giftCode() {
      var used = JSON.parse(localStorage.getItem('wit-used-codes') || '[]');
      var btn = document.querySelector('.btn-gift');
      var input = document.getElementById('gift-input');
      btn.addEventListener('click', function() {
        (window.WitAuth && window.WitAuth.login ? window.WitAuth.login() : Promise.resolve(null)).then(function() {
          var raw = (input.value || '').trim().toUpperCase();
          if (!raw) { return; }
          if (used.indexOf(raw) >= 0) { return; }
          var list = typeof GIFT_CODES !== 'undefined' ? GIFT_CODES : [];
          var found = null;
          for (var i = 0; i < list.length; i++) {
            if (list[i].code.toUpperCase() === raw) { found = list[i]; break; }
          }
          if (!found) { return; }
          used.push(raw);
          localStorage.setItem('wit-used-codes', JSON.stringify(used));
          var c = (window.WitBoutiquePayment && window.WitBoutiquePayment.loadCoinsFromStorage) ? window.WitBoutiquePayment.loadCoinsFromStorage() : 0;
          var newVal = c + found.amount;
          if (window.WitBoutiquePayment && window.WitBoutiquePayment.saveCoinsToStorage) window.WitBoutiquePayment.saveCoinsToStorage(newVal);
          else document.getElementById('coins').textContent = newVal.toLocaleString('en-US', { minimumFractionDigits: 1 });
          input.value = '';
        });
      });
    })();
  </script>
</body>
</html>
